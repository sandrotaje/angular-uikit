angular.module("angularUikit",[]).directive("ukNgAutocomplete",function(a,b){return{restrict:"A",require:"ngModel",scope:{ukSource:"=",ukLabel:"=",ukTemplate:"=",ukOnSelect:"&"},link:function(a,c,d,e){var f=a.ukTemplate?a.ukTemplate:'<ul class="uk-nav uk-nav-autocomplete uk-autocomplete-results">{{~items}}<li data-id="{{$item.id}}" data-value="{{$item.value}}"><a>{{$item.value}}</a></li>{{/items}}</ul>',g=[];a.ukSource?a.ukSource.forEach(function(b,c){var d;d=a.ukLabel&&b.hasOwnProperty(a.ukLabel)?b[a.ukLabel]:"string"==typeof b||b instanceof String?b:"Label missing!",g.push({id:c,value:d})}):g.push({id:void 0,value:"No source detected!"});var h=UIkit.autocomplete(c.parent(),{source:g,minLength:1,delay:0,template:f});a.model={},e.$render=function(){var b=e.$viewValue;b?(c.val(b.value),a.model.id=b.id,a.model.value=b.value):(a.model={},c.val(""))},a.$watch("model.id + model.name",function(){a.model.id&&e.$setViewValue({id:a.model.id,value:a.model.value})}),e.$formatters=[function(a){return a}],e.$parsers.unshift(function(b){if(b instanceof Object&&b.id)return a.ukSource[b.id]}),c.off("change"),h.on("selectitem.uk.autocomplete",function(c,d,f){d&&(e.$setViewValue({id:d.id,value:d.value}),a.ukOnSelect&&b(function(){a.ukOnSelect({$selectedItem:a.ukSource[d.id]})}))}),c.on("blur",function(){e.$modelValue||(c.val(""),e.$setViewValue(void 0))})}}}).directive("ukNgPagination",function(){return{restrict:"AE",scope:{listSize:"=",pageSize:"=",onPageChange:"&"},link:function(a,b,c){var d={items:a.listSize,itemsOnPage:a.pageSize,currentPage:0,displayedPages:3,edges:1},e=UIkit.pagination(b,d);window.pag=e,b.on("select.uk.pagination",function(b,c){a.onPageChange({$page:c})}),a.$watch("listSize",function(){e.options.items=a.listSize,e.pages=Math.ceil(a.listSize/a.pageSize),e.render()}),a.$watch("pageSize",function(){e.options.itemsOnPage=a.pageSize,e.pages=Math.ceil(a.listSize/a.pageSize),e.render()})}}}).directive("ukNgJsonTableForm",function(a,b){function c(a,b){var c='<form name="newItemForm" class="uk-form uk-form-stacked" ng-submit="addItem()" novalidate><fieldset><table ng-init="table.hasChild = false" class="uk-table uk-ng-table-form">';return c+="<thead><tr>",c+='<th data-ng-repeat="h in structure">',c+='<div ng-switch="h.type">',c+='<div ng-switch-when="array" ng-init="table.hasChild = true"></div>',c+='<span ng-switch-default><i ng-if="h.icon" class="uk-icon-{{h.icon}}"></i> {{h.label}}</span>',c+="</div>",c+="</th>",c+="<th></th>",c+="</tr></thead>",c+="<tbody>",c+='<tr class="uk-table-middle" data-ng-repeat="m in model track by $index" ng-init="row.index=$index+1">',c+='<td data-ng-repeat="s in structure">',c+='<div ng-switch="s.type">',c+='<div ng-switch-when="array" class="uk-accordion" data-uk-accordion="{showfirst: false, collapse: false, toggle: \'.uk-accordion-title-{{s.property}}\', containers:\'.uk-accordion-content-{{s.property}}\'}">',c+='<a ng-init="accordion.show = false" ng-click="accordion.show=!accordion.show" class="uk-width-1-1 uk-button uk-button-primary uk-button-large uk-accordion-title-{{s.property}}"><span class="uk-float-left"><i ng-if="s.icon" class="uk-icon-{{s.icon}}"></i> {{m[s.property].length}} {{s.label}} </span> <span class="uk-float-right"><i ng-hide="accordion.show" class="uk-icon-caret-right"></i><i ng-show="accordion.show" class="uk-icon-caret-down"></i></span></a>',c+='<div class="uk-accordion-content-{{s.property}}">',c+='<div data-uk-ng-json-table-form data-model="m[s.property]" data-structure="s.items"></div>',c+="</div></div>",c+='<div ng-switch-when="autocomplete">{{m[s.property][s.autocomplete.label]?m[s.property][s.autocomplete.label]:m[s.property]}}</div>',c+='<div ng-switch-when="select">{{m[s.property][s.select.label]}}</div>',c+='<div ng-switch-when="sequence" ng-init="m.sequence = row.index">{{m.sequence}}</div>',c+="<div ng-switch-default>{{m[s.property]}}</div>",c+="</div>",c+="</td>",c+='<td style="padding:0 0 1px 0"><button type="button" class="uk-button uk-text-danger uk-width-1-1 uk-height-1-1" ng-click="removeItem($index)"><i class="uk-icon-trash uk-icon-small"></i></button></td>',c+="</tr>",c+="<tr>",c+='<td data-ng-repeat="h in structure">',c+='<div ng-switch="h.type">',c+='<span ng-switch-when="array"><button type="submit" style="width:80px" ng-class="{\'uk-text-success\': newItemForm.$valid}" class="uk-button uk-float-left" data-ng-disabled="newItemForm.$invalid"><i class="uk-icon-plus uk-icon-small"></i></button></span>',c+='<span ng-switch-when="sequence">#</span>',c+='<select name="{{h.property}}" ng-switch-when="select" data-ng-model="newItem[h.property]" class="uk-width-1-1" ng-options="opt[h.select.label] for opt in h.select.options track by opt[h.select.id]" required />',c+='<div ng-switch-when="autocomplete" class="uk-autocomplete uk-form uk-width-1-1"><input name="{{h.property}}" type="text" placeholder="{{h.placeholder?h.placeholder:\'\'}}" class="uk-width-1-1" ng-model="newItem[h.property]" data-uk-source="h.autocomplete.source" data-uk-label="h.autocomplete.label" uk-ng-autocomplete required></div>',c+='<input name="{{h.property}}" ng-switch-when="number" data-ng-model="newItem[h.property]" type="number" class="uk-width-1-1" data-ng-max="{{h.number.max}}" data-ng-min="{{h.number.min}}" required>',c+='<input name="{{h.property}}" ng-switch-default data-ng-model="newItem[h.property]" type="{{h.type}}" placeholder="{{h.placeholder?h.placeholder:\'\'}}" class="uk-width-1-1" ng-required="h.required">',c+="</div>",c+="</td>",c+='<td><button ng-if="!table.hasChild" ng-class="{\'uk-text-success\': newItemForm.$valid}" type="submit" class="uk-button" style="width:80px" data-ng-disabled="newItemForm.$invalid"><i class="uk-icon-plus uk-icon-small"></i></button></td>',c+="</tr>",c+="</tbody>",c+="</table></fieldset></form>"}return{restrict:"EA",scope:{model:"=",structure:"="},link:function(d,e,f){d.newItem={},d.model||(d.model=[]);var g=c(d.model,d.structure);e.append(a(angular.element(g))(d)),d.addItem=function(){d.model.push(angular.copy(d.newItem)),d.newItem={}},d.removeItem=function(c){UIkit.modal.confirm("Sei sicuro?",function(){b(function(){d.model.splice(c,1)})})},d.generateTable=c}}});